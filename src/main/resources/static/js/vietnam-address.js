/**
 * Vietnam Address Data and Functions
 */

const vietnamAddressData = {
    "01": {
        "name": "Hà Nội",
        "districts": {
            "001": {
                "name": "Ba Đình",
                "wards": {
                    "00001": "Phường Phúc Xá",
                    "00002": "Phường Trúc Bạch",
                    "00003": "Phường Vĩnh Phúc",
                    "00004": "Phường Cống Vị",
                    "00005": "Phường Liễu Giai",
                    "00006": "Phường Nguyễn Trung Trực",
                    "00007": "Phường Quán Thánh",
                    "00008": "Phường Ngọc Hà",
                    "00009": "Phường Điện Biên",
                    "00010": "Phường Đội Cấn",
                    "00011": "Phường Ngọc Khánh",
                    "00012": "Phường Kim Mã",
                    "00013": "Phường Giảng Võ",
                    "00014": "Phường Thành Công"
                }
            },
            "002": {
                "name": "Hoàn Kiếm",
                "wards": {
                    "00015": "Phường Phúc Tân",
                    "00016": "Phường Đồng Xuân",
                    "00017": "Phường Hàng Mã",
                    "00018": "Phường Hàng Buồm",
                    "00019": "Phường Hàng Đào",
                    "00020": "Phường Hàng Bồ",
                    "00021": "Phường Cửa Đông",
                    "00022": "Phường Lý Thái Tổ",
                    "00023": "Phường Hàng Bạc",
                    "00024": "Phường Hàng Gai",
                    "00025": "Phường Chương Dương Độ",
                    "00026": "Phường Hàng Trống",
                    "00027": "Phường Cửa Nam",
                    "00028": "Phường Hàng Bông",
                    "00029": "Phường Tràng Tiền",
                    "00030": "Phường Trần Hưng Đạo",
                    "00031": "Phường Phan Chu Trinh"
                }
            },
            "003": {
                "name": "Tây Hồ",
                "wards": {
                    "00032": "Phường Phú Thượng",
                    "00033": "Phường Nhật Tân",
                    "00034": "Phường Tứ Liên",
                    "00035": "Phường Quảng An",
                    "00036": "Phường Xuân La",
                    "00037": "Phường Yên Phụ",
                    "00038": "Phường Bưởi",
                    "00039": "Phường Thụy Khuê"
                }
            },
            "004": {
                "name": "Long Biên",
                "wards": {
                    "00040": "Phường Thượng Thanh",
                    "00041": "Phường Ngọc Thụy",
                    "00042": "Phường Giang Biên",
                    "00043": "Phường Đức Giang",
                    "00044": "Phường Việt Hưng",
                    "00045": "Phường Gia Thụy",
                    "00046": "Phường Ngọc Lâm",
                    "00047": "Phường Phúc Lợi",
                    "00048": "Phường Bồ Đề",
                    "00049": "Phường Sài Đồng",
                    "00050": "Phường Long Biên",
                    "00051": "Phường Thạch Bàn",
                    "00052": "Phường Phúc Đông",
                    "00053": "Phường Cự Khối"
                }
            },
            "005": {
                "name": "Cầu Giấy",
                "wards": {
                    "00054": "Phường Nghĩa Đô",
                    "00055": "Phường Nghĩa Tân",
                    "00056": "Phường Mai Dịch",
                    "00057": "Phường Dịch Vọng",
                    "00058": "Phường Dịch Vọng Hậu",
                    "00059": "Phường Quan Hoa",
                    "00060": "Phường Yên Hòa",
                    "00061": "Phường Trung Hòa"
                }
            },
            "006": {
                "name": "Đống Đa",
                "wards": {
                    "00062": "Phường Cát Linh",
                    "00063": "Phường Văn Miếu",
                    "00064": "Phường Quốc Tử Giám",
                    "00065": "Phường Láng Thượng",
                    "00066": "Phường Ô Chợ Dừa",
                    "00067": "Phường Văn Chương",
                    "00068": "Phường Hàng Bột",
                    "00069": "Phường Nam Đồng",
                    "00070": "Phường Trung Liệt",
                    "00071": "Phường Trung Phụng",
                    "00072": "Phường Quang Trung",
                    "00073": "Phường Trung Tự",
                    "00074": "Phường Kim Liên",
                    "00075": "Phường Phương Liên",
                    "00076": "Phường Thổ Quan",
                    "00077": "Phường Lang Hạ",
                    "00078": "Phường Khâm Thiên",
                    "00079": "Phường Thịnh Quang",
                    "00080": "Phường Trung Liệt",
                    "00081": "Phường Láng Hạ"
                }
            },
            "007": {
                "name": "Hai Bà Trưng",
                "wards": {
                    "00082": "Phường Nguyễn Du",
                    "00083": "Phường Bạch Đằng",
                    "00084": "Phường Phạm Đình Hổ",
                    "00085": "Phường Lê Đại Hành",
                    "00086": "Phường Đồng Nhân",
                    "00087": "Phường Phố Huế",
                    "00088": "Phường Đống Mác",
                    "00089": "Phường Thanh Lương",
                    "00090": "Phường Thanh Nhàn",
                    "00091": "Phường Cầu Dền",
                    "00092": "Phường Bách Khoa",
                    "00093": "Phường Đồng Tâm",
                    "00094": "Phường Vĩnh Tuy",
                    "00095": "Phường Bạch Mai",
                    "00096": "Phường Quỳnh Mai",
                    "00097": "Phường Quỳnh Lôi",
                    "00098": "Phường Minh Khai",
                    "00099": "Phường Trương Định"
                }
            },
            "008": {
                "name": "Hoàng Mai",
                "wards": {
                    "00100": "Phường Thanh Trì",
                    "00101": "Phường Vĩnh Hưng",
                    "00102": "Phường Định Công",
                    "00103": "Phường Mai Động",
                    "00104": "Phường Tương Mai",
                    "00105": "Phường Đại Kim",
                    "00106": "Phường Tân Mai",
                    "00107": "Phường Hoàng Văn Thụ",
                    "00108": "Phường Trần Phú",
                    "00109": "Phường Hoàng Liệt",
                    "00110": "Phường Lĩnh Nam",
                    "00111": "Phường Thịnh Liệt",
                    "00112": "Phường Trường Thịnh",
                    "00113": "Phường Yên Sở",
                    "00114": "Phường Giáp Bát"
                }
            },
            "009": {
                "name": "Thanh Xuân",
                "wards": {
                    "00115": "Phường Nhân Chính",
                    "00116": "Phường Thượng Đình",
                    "00117": "Phường Khương Thượng",
                    "00118": "Phường Khương Trung",
                    "00119": "Phường Khương Mai",
                    "00120": "Phường Thanh Xuân Bắc",
                    "00121": "Phường Thanh Xuân Nam",
                    "00122": "Phường Thanh Xuân Trung",
                    "00123": "Phường Hạ Đình",
                    "00124": "Phường Khuông Đình",
                    "00125": "Phường Kim Giang"
                }
            },
            "016": "Hà Đông",
            "017": "Sơn Tây",
            "018": "Ba Vì",
            "019": "Phúc Thọ",
            "020": "Đan Phượng",
            "021": "Hoài Đức",
            "022": "Quốc Oai",
            "023": "Thạch Thất",
            "024": "Chương Mỹ",
            "025": "Thanh Oai",
            "026": "Thường Tín",
            "027": "Phú Xuyên",
            "028": "Ứng Hòa",
            "029": "Mỹ Đức"
        }
    },
    "79": {
        "name": "TP. Hồ Chí Minh",
        "districts": {
            "760": {
                "name": "Quận 1",
                "wards": {
                    "27004": "Phường Tân Định",
                    "27007": "Phường Đa Kao",
                    "27010": "Phường Bến Nghé",
                    "27013": "Phường Bến Thành",
                    "27016": "Phường Nguyễn Thái Bình",
                    "27019": "Phường Phạm Ngũ Lão",
                    "27022": "Phường Cầu Ông Lãnh",
                    "27025": "Phường Cô Giang",
                    "27028": "Phường Nguyễn Cư Trinh",
                    "27031": "Phường Cầu Kho"
                }
            },
            "761": {
                "name": "Quận 12",
                "wards": {
                    "27034": "Phường Thạnh Xuân",
                    "27037": "Phường Thạnh Lộc",
                    "27040": "Phường Hiệp Thành",
                    "27043": "Phường Thới An",
                    "27046": "Phường Tân Chánh Hiệp",
                    "27049": "Phường An Phú Đông",
                    "27052": "Phường Tân Thới Hiệp",
                    "27055": "Phường Trung Mỹ Tây",
                    "27058": "Phường Tân Hưng Thuận",
                    "27061": "Phường Đông Hưng Thuận",
                    "27064": "Phường Tân Thới Nhất"
                }
            },
            "762": {
                "name": "Quận Gò Vấp",
                "wards": {
                    "27067": "Phường 1",
                    "27070": "Phường 3",
                    "27073": "Phường 4",
                    "27076": "Phường 5",
                    "27079": "Phường 6",
                    "27082": "Phường 7",
                    "27085": "Phường 8",
                    "27088": "Phường 9",
                    "27091": "Phường 10",
                    "27094": "Phường 11",
                    "27097": "Phường 12",
                    "27100": "Phường 13",
                    "27103": "Phường 14",
                    "27106": "Phường 15",
                    "27109": "Phường 16",
                    "27112": "Phường 17"
                }
            },
            "763": {
                "name": "Quận Bình Thạnh",
                "wards": {
                    "27115": "Phường 1",
                    "27118": "Phường 2",
                    "27121": "Phường 3",
                    "27124": "Phường 5",
                    "27127": "Phường 6",
                    "27130": "Phường 7",
                    "27133": "Phường 11",
                    "27136": "Phường 12",
                    "27139": "Phường 13",
                    "27142": "Phường 14",
                    "27145": "Phường 15",
                    "27148": "Phường 17",
                    "27151": "Phường 19",
                    "27154": "Phường 21",
                    "27157": "Phường 22",
                    "27160": "Phường 24",
                    "27163": "Phường 25",
                    "27166": "Phường 26",
                    "27169": "Phường 27",
                    "27172": "Phường 28"
                }
            },
            "764": {
                "name": "Quận Tân Bình",
                "wards": {
                    "27175": "Phường 1",
                    "27178": "Phường 2",
                    "27181": "Phường 3",
                    "27184": "Phường 4",
                    "27187": "Phường 5",
                    "27190": "Phường 6",
                    "27193": "Phường 7",
                    "27196": "Phường 8",
                    "27199": "Phường 9",
                    "27202": "Phường 10",
                    "27205": "Phường 11",
                    "27208": "Phường 12",
                    "27211": "Phường 13",
                    "27214": "Phường 14",
                    "27217": "Phường 15"
                }
            },
            "765": {
                "name": "Quận Tân Phú",
                "wards": {
                    "27220": "Phường Tân Sơn Nhì",
                    "27223": "Phường Tây Thạnh",
                    "27226": "Phường Sơn Kỳ",
                    "27229": "Phường Tân Quý",
                    "27232": "Phường Tân Thành",
                    "27235": "Phường Phú Thọ Hòa",
                    "27238": "Phường Phú Thạnh",
                    "27241": "Phường Phú Trung",
                    "27244": "Phường Hòa Thạnh",
                    "27247": "Phường Hiệp Tân",
                    "27250": "Phường Tân Thới Hòa"
                }
            },
            "766": {
                "name": "Quận Phú Nhuận",
                "wards": {
                    "27253": "Phường 1",
                    "27256": "Phường 2",
                    "27259": "Phường 3",
                    "27262": "Phường 4",
                    "27265": "Phường 5",
                    "27268": "Phường 7",
                    "27271": "Phường 8",
                    "27274": "Phường 9",
                    "27277": "Phường 10",
                    "27280": "Phường 11",
                    "27283": "Phường 13",
                    "27286": "Phường 14",
                    "27289": "Phường 15",
                    "27292": "Phường 17"
                }
            },
            "767": {
                "name": "TP. Thủ Đức",
                "wards": {
                    "27295": "Phường Linh Xuân",
                    "27298": "Phường Bình Chiểu",
                    "27301": "Phường Linh Trung",
                    "27304": "Phường Tam Bình",
                    "27307": "Phường Tam Phú",
                    "27310": "Phường Hiệp Bình Phước",
                    "27313": "Phường Hiệp Bình Chánh",
                    "27316": "Phường Linh Chiểu",
                    "27319": "Phường Linh Tây",
                    "27322": "Phường Linh Đông",
                    "27325": "Phường Bình Thọ",
                    "27328": "Phường Trường Thọ"
                }
            },
            "768": {
                "name": "Quận 3",
                "wards": {
                    "27331": "Phường 1",
                    "27334": "Phường 2",
                    "27337": "Phường 3",
                    "27340": "Phường 4",
                    "27343": "Phường 5",
                    "27346": "Phường 6",
                    "27349": "Phường 7",
                    "27352": "Phường 8",
                    "27355": "Phường 9",
                    "27358": "Phường 10",
                    "27361": "Phường 11",
                    "27364": "Phường 12",
                    "27367": "Phường 13",
                    "27370": "Phường 14"
                }
            },
            "769": {
                "name": "Quận 10",
                "wards": {
                    "27373": "Phường 1",
                    "27376": "Phường 2",
                    "27379": "Phường 4",
                    "27382": "Phường 5",
                    "27385": "Phường 6",
                    "27388": "Phường 7",
                    "27391": "Phường 8",
                    "27394": "Phường 9",
                    "27397": "Phường 10",
                    "27400": "Phường 11",
                    "27403": "Phường 12",
                    "27406": "Phường 13",
                    "27409": "Phường 14",
                    "27412": "Phường 15"
                }
            },
            "770": "Quận 11",
            "771": "Quận 4",
            "772": "Quận 5",
            "773": "Quận 6",
            "774": "Quận 8",
            "775": "Quận Bình Tân",
            "776": "Quận 7",
            "777": "Huyện Củ Chi",
            "778": "Huyện Hóc Môn",
            "779": "Huyện Bình Chánh",
            "780": "Huyện Nhà Bè",
            "781": "Huyện Cần Giờ"
        }
    },
    "48": {
        "name": "Đà Nẵng",
        "districts": {
            "490": {
                "name": "Hải Châu",
                "wards": {
                    "20194": "Phường Thạch Thang",
                    "20197": "Phường Hải Châu I",
                    "20200": "Phường Hải Châu II",
                    "20203": "Phường Phước Ninh",
                    "20206": "Phường Hòa Thuận Tây",
                    "20207": "Phường Hòa Thuận Đông",
                    "20209": "Phường Nam Dương",
                    "20212": "Phường Bình Hiên",
                    "20215": "Phường Bình Thuận",
                    "20218": "Phường Hòa Cường Bắc",
                    "20221": "Phường Hòa Cường Nam",
                    "20224": "Phường Thanh Bình",
                    "20227": "Phường Thuận Phước"
                }
            },
            "491": {
                "name": "Thanh Khê",
                "wards": {
                    "20230": "Phường Tam Thuận",
                    "20233": "Phường Thanh Khê Tây",
                    "20236": "Phường Thanh Khê Đông",
                    "20239": "Phường Xuân Hà",
                    "20242": "Phường Tân Chính",
                    "20245": "Phường Chính Gián",
                    "20248": "Phường Vĩnh Trung",
                    "20251": "Phường Thạc Gián",
                    "20254": "Phường An Khê",
                    "20257": "Phường Hòa Khê"
                }
            },
            "492": {
                "name": "Sơn Trà",
                "wards": {
                    "20260": "Phường Thọ Quang",
                    "20263": "Phường Nại Hiên Đông",
                    "20266": "Phường Mân Thái",
                    "20269": "Phường An Hải Bắc",
                    "20272": "Phường Phước Mỹ",
                    "20275": "Phường An Hải Tây",
                    "20278": "Phường An Hải Đông"
                }
            },
            "493": {
                "name": "Ngũ Hành Sơn",
                "wards": {
                    "20281": "Phường Mỹ An",
                    "20284": "Phường Khuê Mỹ",
                    "20287": "Phường Hoà Quý",
                    "20290": "Phường Hoà Hải"
                }
            },
            "494": {
                "name": "Liên Chiểu",
                "wards": {
                    "20293": "Phường Hòa Hiệp Bắc",
                    "20296": "Phường Hòa Hiệp Nam",
                    "20299": "Phường Hòa Khánh Bắc",
                    "20302": "Phường Hòa Khánh Nam",
                    "20305": "Phường Hòa Minh"
                }
            },
            "495": {
                "name": "Cẩm Lệ",
                "wards": {
                    "20308": "Phường Khuê Trung",
                    "20311": "Phường Hòa Phát",
                    "20314": "Phường Hòa An",
                    "20317": "Phường Hòa Thọ Tây",
                    "20320": "Phường Hòa Thọ Đông"
                }
            },
            "496": "Hòa Vang",
            "497": "Hoàng Sa"
        }
    },
    "92": {
        "name": "Cần Thơ",
        "districts": {
            "916": {
                "name": "Ninh Kiều",
                "wards": {
                    "31117": "Phường Cái Khế",
                    "31120": "Phường An Hòa",
                    "31123": "Phường Thới Bình",
                    "31126": "Phường An Nghiệp",
                    "31129": "Phường An Cư",
                    "31132": "Phường Tân An",
                    "31135": "Phường An Phú",
                    "31138": "Phường Xuân Khánh",
                    "31141": "Phường Hưng Lợi",
                    "31144": "Phường An Khánh",
                    "31147": "Phường An Bình"
                }
            },
            "917": {
                "name": "Ô Môn",
                "wards": {
                    "31150": "Phường Châu Văn Liêm",
                    "31153": "Phường Thới Hòa",
                    "31156": "Phường Thới Long",
                    "31159": "Phường Thới An",
                    "31162": "Phường Phước Thới",
                    "31165": "Phường Trường Lạc",
                    "31168": "Xã Long Hưng"
                }
            },
            "918": {
                "name": "Bình Thuỷ",
                "wards": {
                    "31171": "Phường Bình Thủy",
                    "31174": "Phường Trà An",
                    "31177": "Phường Trà Nóc",
                    "31180": "Phường Thới An Đông",
                    "31183": "Phường An Thới",
                    "31186": "Phường Bùi Hữu Nghĩa",
                    "31189": "Phường Long Hòa",
                    "31192": "Phường Long Tuyền"
                }
            },
            "919": {
                "name": "Cái Răng",
                "wards": {
                    "31195": "Phường Lê Bình",
                    "31198": "Phường Hưng Phú",
                    "31201": "Phường Hưng Thạnh",
                    "31204": "Phường Ba Láng",
                    "31207": "Phường Thường Thạnh",
                    "31210": "Phường Phú Thứ",
                    "31213": "Phường Tân Phú"
                }
            },
            "923": "Thốt Nốt",
            "924": "Vĩnh Thạnh",
            "925": "Cờ Đỏ",
            "926": "Phong Điền",
            "927": "Thới Lai"
        }
    },
    "31": {
        "name": "Hải Phòng",
        "districts": {
            "303": "Hồng Bàng",
            "304": "Ngô Quyền",
            "305": "Lê Chân",
            "306": "Hải An",
            "307": "Kiến An",
            "308": "Đồ Sơn",
            "309": "Dương Kinh",
            "311": "Thuỷ Nguyên",
            "312": "An Dương",
            "313": "An Lão",
            "314": "Kiến Thuỵ",
            "315": "Tiên Lãng",
            "316": "Vĩnh Bảo",
            "317": "Cát Hải",
            "318": "Bạch Long Vĩ"
        }
    },
    "02": {
        "name": "Hà Giang",
        "districts": {
            "024": "TP. Hà Giang",
            "026": "Đồng Văn",
            "027": "Mèo Vạc",
            "028": "Yên Minh",
            "029": "Quản Bạ",
            "030": "Vị Xuyên",
            "031": "Bắc Mê",
            "032": "Hoàng Su Phì",
            "033": "Xín Mần",
            "034": "Bắc Quang",
            "035": "Quang Bình"
        }
    },
    "04": {
        "name": "Cao Bằng",
        "districts": {
            "040": "TP. Cao Bằng",
            "042": "Bảo Lâm",
            "043": "Bảo Lạc",
            "044": "Thông Nông",
            "045": "Hà Quảng",
            "046": "Trà Lĩnh",
            "047": "Trùng Khánh",
            "048": "Nguyên Bình",
            "049": "Hòa An",
            "051": "Quảng Uyên",
            "052": "Phục Hòa"
        }
    }
};

class VietnamAddressSelector {
    constructor(provinceSelectId, districtSelectId, wardSelectId, addressInputId) {
        this.provinceSelect = document.getElementById(provinceSelectId);
        this.districtSelect = document.getElementById(districtSelectId);
        this.wardSelect = wardSelectId ? document.getElementById(wardSelectId) : null;
        this.addressInput = addressInputId ? document.getElementById(addressInputId) : null;
        
        // Validate required elements
        if (!this.provinceSelect || !this.districtSelect) {
            console.warn('VietnamAddressSelector: Required elements not found');
            return;
        }
        
        this.init();
    }

    init() {
        this.populateProvinces();
        this.attachEventListeners();
        
        // Initialize ward selector as disabled
        if (this.wardSelect) {
            this.wardSelect.disabled = true;
        }
    }

    populateProvinces() {
        // Clear existing options
        this.provinceSelect.innerHTML = '<option value="">-- Chọn Tỉnh/Thành phố --</option>';
        
        // Add provinces
        Object.keys(vietnamAddressData).forEach(provinceCode => {
            const province = vietnamAddressData[provinceCode];
            const option = document.createElement('option');
            option.value = provinceCode;
            option.textContent = province.name;
            this.provinceSelect.appendChild(option);
        });
    }

    populateDistricts(provinceCode) {
        // Clear existing options
        this.districtSelect.innerHTML = '<option value="">-- Chọn Quận/Huyện --</option>';
        
        // Clear ward selector when district changes
        if (this.wardSelect) {
            this.wardSelect.innerHTML = '<option value="">-- Chọn Phường/Xã --</option>';
            this.wardSelect.disabled = true;
        }
        
        if (!provinceCode || !vietnamAddressData[provinceCode]) {
            this.districtSelect.disabled = true;
            return;
        }

        this.districtSelect.disabled = false;
        const districts = vietnamAddressData[provinceCode].districts;
        
        Object.keys(districts).forEach(districtCode => {
            const option = document.createElement('option');
            option.value = districtCode;
            // Handle both old string format and new object format
            option.textContent = typeof districts[districtCode] === 'string' 
                ? districts[districtCode] 
                : districts[districtCode].name;
            this.districtSelect.appendChild(option);
        });
    }

    populateWards(provinceCode, districtCode) {
        // Clear existing options
        if (!this.wardSelect) return;
        
        this.wardSelect.innerHTML = '<option value="">-- Chọn Phường/Xã --</option>';
        
        if (!provinceCode || !districtCode || !vietnamAddressData[provinceCode]) {
            this.wardSelect.disabled = true;
            return;
        }

        const district = vietnamAddressData[provinceCode].districts[districtCode];
        
        // Check if district has ward data (new object format)
        if (typeof district === 'object' && district.wards) {
            this.wardSelect.disabled = false;
            const wards = district.wards;
            
            try {
                Object.keys(wards).forEach(wardCode => {
                    const option = document.createElement('option');
                    option.value = wardCode;
                    option.textContent = wards[wardCode];
                    this.wardSelect.appendChild(option);
                });
            } catch (error) {
                console.warn('Error populating wards:', error);
                this.wardSelect.disabled = true;
            }
        } else {
            // District doesn't have ward data (old string format), keep disabled
            this.wardSelect.disabled = true;
        }
    }

    attachEventListeners() {
        this.provinceSelect.addEventListener('change', (e) => {
            const provinceCode = e.target.value;
            this.populateDistricts(provinceCode);
            this.updateFullAddress();
        });

        this.districtSelect.addEventListener('change', (e) => {
            const provinceCode = this.provinceSelect.value;
            const districtCode = e.target.value;
            this.populateWards(provinceCode, districtCode);
            this.updateFullAddress();
        });

        if (this.wardSelect) {
            this.wardSelect.addEventListener('change', () => {
                this.updateFullAddress();
            });
        }

        if (this.addressInput) {
            this.addressInput.addEventListener('input', () => {
                this.updateFullAddress();
            });
        }
    }

    updateFullAddress() {
        const provinceCode = this.provinceSelect.value;
        const districtCode = this.districtSelect.value;
        const wardCode = this.wardSelect ? this.wardSelect.value : '';
        const specificAddress = this.addressInput ? this.addressInput.value.trim() : '';

        let fullAddress = '';
        
        try {
            if (specificAddress) {
                fullAddress += specificAddress;
            }

            // Add ward if selected
            if (wardCode && this.wardSelect && vietnamAddressData[provinceCode]) {
                const district = vietnamAddressData[provinceCode].districts[districtCode];
                if (typeof district === 'object' && district.wards && district.wards[wardCode]) {
                    const wardName = district.wards[wardCode];
                    fullAddress += (fullAddress ? ', ' : '') + wardName;
                }
            }

            // Add district
            if (districtCode && vietnamAddressData[provinceCode]) {
                const district = vietnamAddressData[provinceCode].districts[districtCode];
                const districtName = typeof district === 'string' ? district : district.name;
                if (districtName) {
                    fullAddress += (fullAddress ? ', ' : '') + districtName;
                }
            }

            // Add province
            if (provinceCode && vietnamAddressData[provinceCode]) {
                const provinceName = vietnamAddressData[provinceCode].name;
                fullAddress += (fullAddress ? ', ' : '') + provinceName;
            }

            // Update hidden field for form submission
            const hiddenAddressField = document.getElementById('fullShippingAddress');
            if (hiddenAddressField) {
                hiddenAddressField.value = fullAddress;
            }

            // Update display
            const displayElement = document.getElementById('fullAddressDisplay');
            if (displayElement) {
                displayElement.textContent = fullAddress || 'Vui lòng chọn địa chỉ';
            }
        } catch (error) {
            console.warn('Error updating full address:', error);
        }

        return fullAddress;
    }

    getSelectedProvince() {
        const provinceCode = this.provinceSelect.value;
        return provinceCode ? vietnamAddressData[provinceCode].name : '';
    }

    getSelectedDistrict() {
        const provinceCode = this.provinceSelect.value;
        const districtCode = this.districtSelect.value;
        
        if (provinceCode && districtCode && vietnamAddressData[provinceCode]) {
            const district = vietnamAddressData[provinceCode].districts[districtCode];
            return typeof district === 'string' ? district : district.name || '';
        }
        return '';
    }

    getSelectedWard() {
        if (!this.wardSelect) return '';
        
        const provinceCode = this.provinceSelect.value;
        const districtCode = this.districtSelect.value;
        const wardCode = this.wardSelect.value;
        
        if (provinceCode && districtCode && wardCode && vietnamAddressData[provinceCode]) {
            const district = vietnamAddressData[provinceCode].districts[districtCode];
            if (typeof district === 'object' && district.wards && district.wards[wardCode]) {
                return district.wards[wardCode];
            }
        }
        return '';
    }
}

// Initialize when DOM is loaded
document.addEventListener('DOMContentLoaded', function() {
    // Check if we're on checkout page
    if (document.getElementById('provinceSelect')) {
        window.addressSelector = new VietnamAddressSelector(
            'provinceSelect',
            'districtSelect',
            'wardSelect',
            'specificAddress'
        );
    }
});